<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tauschb√∂rse - Demo Modus</title>
    <style>
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; padding: 20px; background: #f4f4f4; color: #333; text-align: center; }
        .card { background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: left; }
        .logo-container { margin-bottom: 0px; }
        .logo-img { max-width: 100%; height: auto; max-height: 80px; }
        h2 { color: #1a237e; font-size: 28px; font-weight: 900; text-transform: uppercase; border-bottom: 2px solid #1a237e; display: inline-block; padding-bottom: 5px; margin-bottom: 20px; }
        
        input, textarea, button, select { padding: 12px; margin: 8px 0; width: 100%; box-sizing: border-box; border-radius: 4px; border: 1px solid #ccc; font-size: 16px; }
        button { background: #007bff; color: white; border: none; cursor: pointer; font-weight: bold; }
        .contact-btn-inner { background: #28a745; margin-top: 10px; display: block; text-decoration: none; color: white; padding: 12px; border-radius: 4px; text-align: center; font-weight: bold; }
        .edit-btn { background: #6c757d; margin-top: 10px; flex: 1; }
        .delete-btn { background: #ff9800; margin-top: 10px; flex: 1; }
        .logout-btn { background: #dc3545; padding: 8px; font-size: 14px; width: auto; }
        .hidden { display: none !important; }
        .warning-box { background: #fff3cd; color: #856404; padding: 15px; border-radius: 8px; border: 1px solid #ffeeba; margin-bottom: 15px; }
        .item-img { width: 100%; border-radius: 5px; margin: 10px 0; max-height: 300px; object-fit: cover; }
        
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; color: white; display: inline-block; margin-bottom: 5px; }
        .badge-suche { background: #ff9800; }
        .badge-biete { background: #28a745; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 2000; padding: 15px; box-sizing: border-box; }
        .modal-content { background: white; width: 100%; max-width: 500px; padding: 25px; border-radius: 12px; max-height: 90vh; overflow-y: auto; text-align: left; position: relative; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .close-x { position: absolute; right: 15px; top: 10px; font-size: 32px; cursor: pointer; color: #999; line-height: 1; padding: 5px; }
    </style>
</head>
<body>

    <div class="logo-container">
        <img src="https://via.placeholder.com/200x80?text=LOGO+HIER" alt="Logo" class="logo-img">
    </div>

    <h2>Tauschb√∂rse</h2>

    <div id="login-area" class="card">
        <div id="auth-login">
            <h3>Anmelden (Demo)</h3>
            <input type="email" id="email" placeholder="E-Mail (beliebig)" value="test@example.com">
            <input type="password" id="pass" placeholder="Passwort" value="passwort123">
            <button onclick="simulateLogin()">Anmelden</button>
            <p><a onclick="toggleAuth('register')" style="cursor:pointer; color:#007bff">Neues Konto erstellen</a></p>
        </div>

        <div id="auth-register" class="hidden">
            <h3>Registrieren (Demo)</h3>
            <input type="text" id="reg-user" placeholder="Nutzername">
            <input type="email" id="reg-email" placeholder="E-Mail">
            <input type="password" id="reg-pass" placeholder="Passwort">
            <input type="password" id="reg-pass-confirm" placeholder="Wiederholen">
            <button onclick="simulateLogin()" style="background:#28a745">Konto erstellen</button>
            <p><a onclick="toggleAuth('login')" style="cursor:pointer; color:#007bff">Zur√ºck zum Login</a></p>
        </div>
    </div>

    <div id="main-area" class="hidden">
        <div class="card" style="display: flex; justify-content: space-between; align-items: center;">
            <span>Hallo, <b id="username-display">Demo Nutzer</b></span>
            <button onclick="location.reload()" class="logout-btn">Abmelden</button>
        </div>

        <button id="show-form-btn" onclick="openForm()">+ Neuen Eintrag (Suche/Biete)</button>
        <div id="artikel-liste"></div>
    </div>

    <div id="modal-container" class="modal-overlay hidden" onclick="if(event.target.id==='modal-container')closeForm()">
        <div class="modal-content">
            <span class="close-x" onclick="closeForm()">&times;</span>
            <h3 id="form-title">Neuer Eintrag</h3>
            <input type="hidden" id="edit-id">
            
            <label style="font-size: 13px; font-weight: bold;">Art des Eintrags:</label>
            <select id="typ">
                <option value="biete">Ich biete etwas an</option>
                <option value="suche">Ich suche etwas</option>
            </select>

            <input type="text" id="title" placeholder="Titel">
            <input type="text" id="standort" placeholder="Standort (z.B. Stadtteil)">
            <textarea id="beschreibung" placeholder="Beschreibung" rows="4"></textarea>
            
            <p style="font-size: 13px; font-weight: bold; margin: 10px 0 0 0;">Foto:</p>
            <p style="font-size: 11px; color: #666; margin-bottom: 5px;">(Pflicht bei Angeboten, optional bei Gesuchen)</p>
            <input type="file" id="foto" accept="image/*">
            
            <button onclick="artikelSpeichern()" id="save-btn" style="background:#28a745; margin-top: 15px;">Speichern</button>
            <button onclick="closeForm()" style="background:#6c757d">Abbrechen</button>
        </div>
    </div>

    <script>
        // BEISPIEL-DATEN
        let demoDaten = [
            {
                id: '1', typ: 'biete', title: 'B√ºcherregal Holz', standort: 'Mitte', 
                beschreibung: 'Sehr gut erhalten, zur Selbstabholung.', 
                user: 'Max Mustermann', created: new Date().toISOString(), 
                foto: 'https://images.unsplash.com/photo-1594620302200-9a762244a156?w=400'
            },
            {
                id: '2', typ: 'suche', title: 'Suche Hilfe im Garten', standort: 'S√ºd-Stadt', 
                beschreibung: 'Suche jemanden, der beim Hecke schneiden hilft. Biete Kuchen!', 
                user: 'Erika Schmidt', created: new Date().toISOString(), 
                foto: null
            },
            {
                id: '3', typ: 'biete', title: 'Kaffeemaschine', standort: 'West', 
                beschreibung: 'Voll funktionsf√§hig, wegen Neuanschaffung abzugeben.', 
                user: 'Demo Nutzer', created: new Date().toISOString(), 
                foto: 'https://images.unsplash.com/photo-1517668808822-9ebb02f2a0e6?w=400'
            }
        ];

        // LOGIK
        function toggleAuth(mode) {
            document.getElementById('auth-login').classList.toggle('hidden', mode === 'register');
            document.getElementById('auth-register').classList.toggle('hidden', mode === 'login');
        }

        function simulateLogin() {
            document.getElementById('login-area').classList.add('hidden');
            document.getElementById('main-area').classList.remove('hidden');
            ladeArtikel();
        }

        function openForm(editData = null) {
            document.getElementById('modal-container').classList.remove('hidden');
            if (editData) {
                document.getElementById('form-title').innerText = "Eintrag bearbeiten";
                document.getElementById('edit-id').value = editData.id;
                document.getElementById('typ').value = editData.typ;
                document.getElementById('title').value = editData.title;
                document.getElementById('standort').value = editData.standort;
                document.getElementById('beschreibung').value = editData.beschreibung;
            } else {
                document.getElementById('form-title').innerText = "Neuer Eintrag";
                document.getElementById('edit-id').value = "";
                document.getElementById('typ').value = "biete";
                document.getElementById('title').value = "";
                document.getElementById('standort').value = "";
                document.getElementById('beschreibung').value = "";
            }
        }

        function closeForm() {
            document.getElementById('modal-container').classList.add('hidden');
        }

        async function artikelSpeichern() {
            const typ = document.getElementById('typ').value;
            const title = document.getElementById('title').value;
            const standort = document.getElementById('standort').value;
            const beschreibung = document.getElementById('beschreibung').value;
            const fileInput = document.getElementById('foto');
            const editId = document.getElementById('edit-id').value;

            // Logik: Foto nur Pflicht bei BIETE (wenn neu)
            if (typ === 'biete' && !editId && !fileInput.files[0]) {
                alert("Bitte w√§hle ein Foto f√ºr dein Angebot aus.");
                return;
            }

            let imageData = null;
            if(fileInput.files[0]) {
                imageData = await new Promise(r => {
                    const reader = new FileReader();
                    reader.onload = e => r(e.target.result);
                    reader.readAsDataURL(fileInput.files[0]);
                });
            }

            if (editId) {
                const idx = demoDaten.findIndex(a => a.id === editId);
                demoDaten[idx] = { ...demoDaten[idx], typ, title, standort, beschreibung, foto: imageData || demoDaten[idx].foto };
            } else {
                demoDaten.unshift({
                    id: 'd' + Date.now(),
                    typ, title, standort, beschreibung,
                    user: 'Demo Nutzer', created: new Date().toISOString(),
                    foto: imageData
                });
            }

            closeForm();
            ladeArtikel();
        }

        function ladeArtikel() {
            const liste = document.getElementById('artikel-liste');
            liste.innerHTML = demoDaten.map(item => {
                const badgeClass = item.typ === 'suche' ? 'badge-suche' : 'badge-biete';
                const isMyItem = item.user === 'Demo Nutzer';

                return `
                    <div class="card" style="border-top: 4px solid ${item.typ === 'suche' ? '#ff9800' : '#28a745'}">
                        <span class="badge ${badgeClass}">${item.typ.toUpperCase()}</span>
                        ${item.foto ? `<img src="${item.foto}" class="item-img">` : ''}
                        <h4>${item.title}</h4>
                        <p>${item.beschreibung}</p>
                        <div style="font-size: 13px; color: #666; border-top: 1px solid #eee; padding-top: 8px; margin-top: 10px;">
                            <span>Von: <b>${item.user}</b></span> | üìç Ort: <b>${item.standort}</b>
                        </div>
                        <button class="contact-btn-inner" onclick="alert('üìß Kontakt zu ${item.user} wird hergestellt...')">üìß Kontaktieren</button>
                        ${isMyItem ? `
                            <div style="display:flex; gap:10px">
                                <button class="edit-btn" onclick='openForm(${JSON.stringify(item)})'>‚úèÔ∏è Bearbeiten</button>
                                <button class="delete-btn" onclick="loescheArtikel('${item.id}')">üóëÔ∏è L√∂schen</button>
                            </div>` : ''}
                    </div>`;
            }).join('');
        }

        function loescheArtikel(id) {
            if (confirm("Wirklich l√∂schen?")) {
                demoDaten = demoDaten.filter(a => a.id !== id);
                ladeArtikel();
            }
        }
    </script>
</body>
</html>
